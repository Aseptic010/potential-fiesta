<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>系统配置 - 舱单邮件自动处理系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>系统配置</h1>
        <nav>
            <div class="nav nav-tabs" id="configTabs" role="tablist">
                <button class="nav-link active" id="email-tab" data-bs-toggle="tab" data-bs-target="#email" type="button" role="tab">邮箱配置</button>
                <button class="nav-link" id="keywords-tab" data-bs-toggle="tab" data-bs-target="#keywords" type="button" role="tab">关键词配置</button>
                <button class="nav-link" id="sms-tab" data-bs-toggle="tab" data-bs-target="#sms" type="button" role="tab">短信配置</button>
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">系统设置</button>
                <button class="nav-link" id="recipients-tab" data-bs-toggle="tab" data-bs-target="#recipients" type="button" role="tab">额外收件人</button>
            </div>
        </nav>
        
        <div class="tab-content mt-3" id="configTabsContent">
            <!-- 邮箱配置表单 -->
            <div class="tab-pane fade show active" id="email" role="tabpanel">
                <h3>邮箱配置</h3>
                <form id="emailForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">进口邮箱地址</label>
                            <input type="email" class="form-control" id="import_email" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">进口邮箱密码/授权码</label>
                            <input type="password" class="form-control" id="import_password" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">出口邮箱地址</label>
                            <input type="email" class="form-control" id="export_email" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">出口邮箱密码/授权码</label>
                            <input type="password" class="form-control" id="export_password" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">POP3服务器</label>
                            <input type="text" class="form-control" id="pop3_server" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">POP3端口</label>
                            <input type="number" class="form-control" id="pop3_port" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">SMTP服务器</label>
                            <input type="text" class="form-control" id="smtp_server" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">SMTP端口</label>
                            <input type="number" class="form-control" id="smtp_port" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">保存配置</button>
                </form>
            </div>
            
            <!-- 关键词配置表单 -->
            <div class="tab-pane fade" id="keywords" role="tabpanel">
                <h3>关键词配置</h3>
                <form id="keywordsForm">
                    <div class="mb-3">
                        <label class="form-label">进口关键词（每行一个）</label>
                        <textarea class="form-control" id="import_keywords" rows="5"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">出口关键词（每行一个）</label>
                        <textarea class="form-control" id="export_keywords" rows="5"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">保存配置</button>
                </form>
            </div>
            
            <!-- 短信配置表单 -->
            <div class="tab-pane fade" id="sms" role="tabpanel">
                <h3>短信配置</h3>
                <form id="smsForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">短信账户</label>
                            <input type="text" class="form-control" id="sms_account">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">短信密码</label>
                            <input type="password" class="form-control" id="sms_password">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">目标手机号码（多个用逗号分隔）</label>
                        <input type="text" class="form-control" id="sms_mobiles">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">进口短信模板</label>
                        <input type="text" class="form-control" id="sms_import_template">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">出口短信模板</label>
                        <input type="text" class="form-control" id="sms_export_template">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">短信API地址</label>
                        <input type="url" class="form-control" id="sms_api_url">
                    </div>
                    
                    <button type="submit" class="btn btn-primary">保存配置</button>
                </form>
            </div>
            
            <!-- 系统设置表单 -->
            <div class="tab-pane fade" id="settings" role="tabpanel">
                <h3>系统设置</h3>
                <form id="settingsForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">检查间隔（秒）</label>
                            <input type="number" class="form-control" id="check_interval" min="10">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">日志保留天数</label>
                            <input type="number" class="form-control" id="log_retention_days" min="1">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">数据库保留天数</label>
                            <input type="number" class="form-control" id="db_retention_days" min="7">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">界面字体大小</label>
                            <input type="number" class="form-control" id="font_size" min="8" max="20">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">界面主题</label>
                        <select class="form-select" id="theme">
                            <option value="dark-blue">深蓝色</option>
                            <option value="light-gray">浅灰色</option>
                            <option value="system">跟随系统</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">保存配置</button>
                </form>
            </div>
            
            <!-- 额外收件人配置 -->
            <div class="tab-pane fade" id="recipients" role="tabpanel">
                <h3>额外收件人配置</h3>
                <p>自动回复邮件时，除了发件人外，还会发送给以下邮箱地址</p>
                <form id="recipientsForm">
                    <div class="mb-3">
                        <label class="form-label">进口舱单额外收件人（每行一个邮箱）</label>
                        <textarea class="form-control" id="import_recipients" rows="5" placeholder="例如：abc@example.com&#10;def@example.com"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">出口舱单额外收件人（每行一个邮箱）</label>
                        <textarea class="form-control" id="export_recipients" rows="5" placeholder="例如：abc@example.com&#10;def@example.com"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">保存配置</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 加载配置数据
        $(document).ready(function() {
            // 获取配置数据
            $.get('/api/config', function(data) {
                if (data.success) {
                    let config = data.data;
                    
                    // 填充邮箱配置
                    $('#import_email').val(config.email.import_email);
                    $('#import_password').val(config.email.import_password);
                    $('#export_email').val(config.email.export_email);
                    $('#export_password').val(config.email.export_password);
                    $('#pop3_server').val(config.email.pop3_server);
                    $('#pop3_port').val(config.email.pop3_port);
                    $('#smtp_server').val(config.email.smtp_server);
                    $('#smtp_port').val(config.email.smtp_port);
                    
                    // 填充关键词配置
                    $('#import_keywords').val(config.keywords.import.join('\n'));
                    $('#export_keywords').val(config.keywords.export.join('\n'));
                    
                    // 填充短信配置
                    $('#sms_account').val(config.sms.account);
                    $('#sms_password').val(config.sms.password);
                    $('#sms_mobiles').val(config.sms.mobiles);
                    $('#sms_import_template').val(config.sms.import_template);
                    $('#sms_export_template').val(config.sms.export_template);
                    $('#sms_api_url').val(config.sms.api_url);
                    
                    // 填充系统设置
                    $('#check_interval').val(config.settings.check_interval);
                    $('#log_retention_days').val(config.settings.log_retention_days);
                    $('#db_retention_days').val(config.settings.db_retention_days);
                    $('#font_size').val(config.settings.font_size);
                    $('#theme').val(config.settings.theme);
                    
                    // 填充额外收件人
                    $('#import_recipients').val(config.additional_recipients.import.join('\n'));
                    $('#export_recipients').val(config.additional_recipients.export.join('\n'));
                } else {
                    alert('加载配置失败: ' + data.message);
                }
            }).fail(function() {
                alert('加载配置失败');
            });
            
            // 邮箱配置表单提交
            $('#emailForm').submit(function(e) {
                e.preventDefault();
                let emailConfig = {
                    import_email: $('#import_email').val(),
                    import_password: $('#import_password').val(),
                    export_email: $('#export_email').val(),
                    export_password: $('#export_password').val(),
                    pop3_server: $('#pop3_server').val(),
                    pop3_port: parseInt($('#pop3_port').val()),
                    smtp_server: $('#smtp_server').val(),
                    smtp_port: parseInt($('#smtp_port').val())
                };
                
                $.post('/api/config/email', emailConfig, function(data) {
                    if (data.success) {
                        alert('邮箱配置已保存');
                    } else {
                        alert('保存失败: ' + data.message);
                    }
                });
            });
            
            // 关键词配置表单提交
            $('#keywordsForm').submit(function(e) {
                e.preventDefault();
                let importKeywords = $('#import_keywords').val().split('\n').filter(k => k.trim() !== '');
                let exportKeywords = $('#export_keywords').val().split('\n').filter(k => k.trim() !== '');
                
                $.post('/api/config/keywords', {
                    import: importKeywords,
                    export: exportKeywords
                }, function(data) {
                    if (data.success) {
                        alert('关键词配置已保存');
                    } else {
                        alert('保存失败: ' + data.message);
                    }
                });
            });
            
            // 短信配置表单提交
            $('#smsForm').submit(function(e) {
                e.preventDefault();
                let smsConfig = {
                    account: $('#sms_account').val(),
                    password: $('#sms_password').val(),
                    mobiles: $('#sms_mobiles').val(),
                    import_template: $('#sms_import_template').val(),
                    export_template: $('#sms_export_template').val(),
                    api_url: $('#sms_api_url').val()
                };
                
                $.post('/api/config/sms', smsConfig, function(data) {
                    if (data.success) {
                        alert('短信配置已保存');
                    } else {
                        alert('保存失败: ' + data.message);
                    }
                });
            });
            
            // 系统设置表单提交
            $('#settingsForm').submit(function(e) {
                e.preventDefault();
                let settings = {
                    check_interval: parseInt($('#check_interval').val()),
                    log_retention_days: parseInt($('#log_retention_days').val()),
                    db_retention_days: parseInt($('#db_retention_days').val()),
                    theme: $('#theme').val(),
                    font_size: parseInt($('#font_size').val())
                };
                
                $.post('/api/config/settings', settings, function(data) {
                    if (data.success) {
                        alert('系统设置已保存');
                    } else {
                        alert('保存失败: ' + data.message);
                    }
                });
            });
            
            // 额外收件人配置表单提交
            $('#recipientsForm').submit(function(e) {
                e.preventDefault();
                let importRecipients = $('#import_recipients').val().split('\n').filter(r => r.trim() !== '');
                let exportRecipients = $('#export_recipients').val().split('\n').filter(r => r.trim() !== '');
                
                $.post('/api/config/recipients', {
                    import: importRecipients,
                    export: exportRecipients
                }, function(data) {
                    if (data.success) {
                        alert('额外收件人配置已保存');
                    } else {
                        alert('保存失败: ' + data.message);
                    }
                });
            });
        });
    </script>
</body>
</html>